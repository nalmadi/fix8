<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>fix8 &#8212; fix8 2024 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=6fefd858"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for fix8</h1><div class="highlight"><pre>
<span></span><span class="c1"># Fix8</span>
<span class="c1">#</span>
<span class="c1"># Authors: Naser Al Madi &lt;nsalmadi@colby.edu&gt;</span>
<span class="c1">#          Brett Torra</span>
<span class="c1">#          Agnes Li</span>
<span class="c1">#          Najam Tariq</span>
<span class="c1">#          Ricky Peng (contributed to a previous version)</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># URL: https://github.com/nalmadi/fix8</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># The algorithms were implemented by:</span>
<span class="c1">#          Jon Carr</span>
<span class="c1"># URL: https://github.com/jwcarr/drift</span>
<span class="c1"># For license information, see LICENSE.TXT</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Fix8 (Fixate) is an open source Python GUI tool for visualizing and correcting</span>
<span class="sd">eye tracking data.  Fix8 supports manual, automated, and semi-automated </span>
<span class="sd">correction methods for eye tracking data in reading tasks.</span>

<span class="sd">(If you use Fix8 in academic research, please cite our paper)</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="n">QColor</span>

<span class="c1"># from PyQt5.QtWidgets import *</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">QApplication</span><span class="p">,</span>
    <span class="n">QFileDialog</span><span class="p">,</span>
    <span class="n">QColorDialog</span><span class="p">,</span>
    <span class="n">QMessageBox</span><span class="p">,</span>
    <span class="n">QInputDialog</span><span class="p">,</span>
    <span class="n">QListWidgetItem</span><span class="p">,</span>
    <span class="n">QTableWidgetItem</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.image</span> <span class="k">as</span> <span class="nn">mpimg</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Rectangle</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">listdir</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="c1"># import matplotlib.animation as animation</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">mini_emtk</span>
<span class="kn">import</span> <span class="nn">merge_fixations_dialog</span> <span class="k">as</span> <span class="nn">mfd</span>
<span class="kn">import</span> <span class="nn">generate_fixations_skip_dialog</span> <span class="k">as</span> <span class="nn">gfsd</span>
<span class="kn">import</span> <span class="nn">eyelink_csv_dialog</span> <span class="k">as</span> <span class="nn">ecd</span>
<span class="kn">import</span> <span class="nn">state</span>
<span class="kn">import</span> <span class="nn">ui_main_window</span>

<span class="c1"># from PySide2 import QtWidgets</span>
<span class="c1"># from PyQt5 import QtWidgets</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">platform</span>


<div class="viewcode-block" id="Fix8">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8">[docs]</a>
<span class="k">class</span> <span class="nc">Fix8</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># fields relating to the stimulus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_file_path</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># fields relating to the trial folder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial_name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># fields relating to fixations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eye_events</span> <span class="o">=</span> <span class="kc">None</span>              <span class="c1"># dataframe of eye events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span> <span class="o">=</span> <span class="kc">None</span>      <span class="c1"># TODO: make this original_eye_events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="kc">None</span>               <span class="c1"># TODO: replace with eye events:  timestamp, x, y, duration, pupil</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saccades</span> <span class="o">=</span> <span class="kc">None</span>                <span class="c1"># TODO: replace with eye events:  timestamp, x, y, duration, x1, y1, amplitude, peak velocity </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blinks</span> <span class="o">=</span> <span class="kc">None</span>                  <span class="c1"># TODO: replace with eye events:  timestamp duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixation_points</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saccade_lines</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>          <span class="c1"># progress bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># filed for tool undo/redo using memento pattern and state class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_history</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">History</span><span class="p">()</span>

        <span class="c1"># fields relating to AOIs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># fields relating to the correction algorithm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="s2">&quot;manual&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm_function</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secondery_algorithm_function</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_fixation</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># keeps track of how many times file was saved so duplicates can be saved instead of overriding previous save file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer_start</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># beginning time of trial</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saccade_opacity</span> <span class="o">=</span> <span class="mf">0.4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixation_opacity</span> <span class="o">=</span> <span class="mf">0.4</span>

        <span class="c1"># fields relating to the drag and drop system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span> <span class="o">=</span> <span class="kc">None</span>           <span class="c1"># clicked fixation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locked_x</span> <span class="o">=</span> <span class="kc">False</span>    

        <span class="c1"># fields relating to aoi margin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aoi_width</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aoi_height</span> <span class="o">=</span> <span class="mi">4</span>

        <span class="c1"># fields relating to color filters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixation_color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation_color</span> <span class="o">=</span> <span class="s2">&quot;magenta&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suggested_fixation_color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remaining_fixation_color</span> <span class="o">=</span> <span class="s2">&quot;grey&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saccade_color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aoi_color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colorblind_assist_status</span> <span class="o">=</span> <span class="kc">False</span>
        
        <span class="c1"># fields relating to fixation size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixation_size</span> <span class="o">=</span> <span class="mi">30</span>

        <span class="c1"># fields relating to saccade line width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saccade_line_size</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># create the main window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fix8</span> <span class="o">=</span> <span class="n">QApplication</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span> <span class="o">=</span> <span class="n">ui_main_window</span><span class="o">.</span><span class="n">Ui_Main_Window</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># hide/show side panel until a folder is opened</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">hide_side_panel</span><span class="p">()</span>


<div class="viewcode-block" id="Fix8.generate_fixations">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.generate_fixations">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_fixations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">minimum_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">maximum_value</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Dispersion&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Enter value for dispersion around the optimal viewing position in pixels(0-100)&quot;</span>
        <span class="n">dispersion</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">minimum_value</span><span class="p">,</span> <span class="n">maximum_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># clear history for undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_history</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">History</span><span class="p">()</span>

        <span class="c1"># get aoi from the image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="n">mini_emtk</span><span class="o">.</span><span class="n">EMTK_find_aoi</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_file_path</span><span class="p">,</span>
            <span class="n">margin_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi_height</span><span class="p">,</span>
            <span class="n">margin_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi_width</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># generate fixations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mini_emtk</span><span class="o">.</span><span class="n">generate_fixations_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">,</span> <span class="n">dispersion</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">relevant_buttons</span><span class="p">(</span><span class="s2">&quot;trial_clicked&quot;</span><span class="p">)</span>

        <span class="c1">#self.read_json_fixations(self.trial_path)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># double clicking trial should show all and make the current fixation the last one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  

        <span class="c1"># set the progress bar to the amount of fixations found</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="s2">&quot;Generated fixations,,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label_progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;0/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label_progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="c1"># corrected fixations will be the current fixations on the screen and in the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_fixations</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_saccades</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span><span class="s2">&quot; Generated synthetic data&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_trial_statistics</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.generate_fixations_skip">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.generate_fixations_skip">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_fixations_skip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">dialog</span> <span class="o">=</span> <span class="n">gfsd</span><span class="o">.</span><span class="n">GenerateFixationsSkipDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">)</span>
        <span class="n">dialog</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        <span class="n">approximate_letter_width</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">k_value</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">getInputs</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">approximate_letter_width</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">lam</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">k_value</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># clear history for undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_history</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">History</span><span class="p">()</span>

        <span class="c1"># get aoi from the image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="n">mini_emtk</span><span class="o">.</span><span class="n">EMTK_find_aoi</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_file_path</span><span class="p">,</span>
            <span class="n">margin_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi_height</span><span class="p">,</span>
            <span class="n">margin_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi_width</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="c1"># generate fixations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mini_emtk</span><span class="o">.</span><span class="n">generate_fixations_left_skip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">,</span> <span class="n">approximate_letter_width</span><span class="p">,</span> <span class="n">lam</span><span class="p">,</span> <span class="n">k_value</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">relevant_buttons</span><span class="p">(</span><span class="s2">&quot;trial_clicked&quot;</span><span class="p">)</span>

        <span class="c1">#self.read_json_fixations(self.trial_path)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># double clicking trial should show all and make the current fixation the last one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  

        <span class="c1"># set the progress bar to the amount of fixations found</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="s2">&quot;Generated fixations,,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label_progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;0/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label_progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="c1"># corrected fixations will be the current fixations on the screen and in the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_fixations</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_saccades</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span><span class="s2">&quot; Generated synthetic data&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_trial_statistics</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.generate_within_line_regression">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.generate_within_line_regression">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_within_line_regression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">minimum_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">maximum_value</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Within-line regression&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Enter within-line regression probability (0-100)&quot;</span>
        <span class="n">probability</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">minimum_value</span><span class="p">,</span> <span class="n">maximum_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># clear history for undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_history</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">History</span><span class="p">()</span>

        <span class="c1"># get aoi from the image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="n">mini_emtk</span><span class="o">.</span><span class="n">EMTK_find_aoi</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_file_path</span><span class="p">,</span>
            <span class="n">margin_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi_height</span><span class="p">,</span>
            <span class="n">margin_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi_width</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># generate fixations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mini_emtk</span><span class="o">.</span><span class="n">within_line_regression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">,</span> <span class="n">probability</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">relevant_buttons</span><span class="p">(</span><span class="s2">&quot;trial_clicked&quot;</span><span class="p">)</span>

        <span class="c1">#self.read_json_fixations(self.trial_path)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># double clicking trial should show all and make the current fixation the last one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  

        <span class="c1"># set the progress bar to the amount of fixations found</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="s2">&quot;Generated fixations,,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label_progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;0/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label_progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="c1"># corrected fixations will be the current fixations on the screen and in the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_fixations</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_saccades</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span><span class="s2">&quot; Generated synthetic data&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_trial_statistics</span><span class="p">()</span></div>


<div class="viewcode-block" id="Fix8.generate_between_line_regression">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.generate_between_line_regression">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_between_line_regression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">minimum_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">maximum_value</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Between-line regression&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Enter Between-line regression probability (0-100)&quot;</span>
        <span class="n">probability</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">minimum_value</span><span class="p">,</span> <span class="n">maximum_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># clear history for undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_history</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">History</span><span class="p">()</span>

        <span class="c1"># get aoi from the image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="n">mini_emtk</span><span class="o">.</span><span class="n">EMTK_find_aoi</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_file_path</span><span class="p">,</span>
            <span class="n">margin_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi_height</span><span class="p">,</span>
            <span class="n">margin_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi_width</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># generate fixations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mini_emtk</span><span class="o">.</span><span class="n">between_line_regression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">,</span> <span class="n">probability</span><span class="o">/</span><span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">relevant_buttons</span><span class="p">(</span><span class="s2">&quot;trial_clicked&quot;</span><span class="p">)</span>

        <span class="c1">#self.read_json_fixations(self.trial_path)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># double clicking trial should show all and make the current fixation the last one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  

        <span class="c1"># set the progress bar to the amount of fixations found</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="s2">&quot;Generated fixations,,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label_progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;0/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label_progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="c1"># corrected fixations will be the current fixations on the screen and in the data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_fixations</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_saccades</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span><span class="s2">&quot; Generated synthetic data&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_trial_statistics</span><span class="p">()</span></div>


<div class="viewcode-block" id="Fix8.generate_noise">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.generate_noise">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">minimum_value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">maximum_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Noise Distortion&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Magnitude of noise distortion (1-10)&quot;</span>
        <span class="n">threshold</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">minimum_value</span><span class="p">,</span> <span class="n">maximum_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;generate,noise &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">!=</span> <span class="s2">&quot;manual&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

        

<div class="viewcode-block" id="Fix8.generate_slope">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.generate_slope">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_slope</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">minimum_value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">maximum_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Slope Distortion&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Magnitude of skope distortion (1-10)&quot;</span>
        <span class="n">threshold</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">minimum_value</span><span class="p">,</span> <span class="n">maximum_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;generate,slope &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mini_emtk</span><span class="o">.</span><span class="n">error_droop</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="Fix8.generate_offset">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.generate_offset">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">minimum_value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">maximum_value</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Offset Distortion&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Magnitude of offset distortion (1-300)&quot;</span>
        <span class="n">threshold</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">minimum_value</span><span class="p">,</span> <span class="n">maximum_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;generate,offset &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mini_emtk</span><span class="o">.</span><span class="n">error_offset</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.generate_shift">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.generate_shift">[docs]</a>
    <span class="k">def</span> <span class="nf">generate_shift</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">minimum_value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">maximum_value</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Shift Distortion&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Magnitude of Shift distortion (1-10)&quot;</span>
        <span class="n">threshold</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">minimum_value</span><span class="p">,</span> <span class="n">maximum_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;generate,shift &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>

        <span class="c1"># get aoi from the image</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="n">mini_emtk</span><span class="o">.</span><span class="n">EMTK_find_aoi</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_file_path</span><span class="p">,</span>
            <span class="n">margin_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi_height</span><span class="p">,</span>
            <span class="n">margin_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi_width</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># get line_Y from aoi</span>
        <span class="n">line_Y</span> <span class="o">=</span> <span class="n">mini_emtk</span><span class="o">.</span><span class="n">find_lines_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mini_emtk</span><span class="o">.</span><span class="n">error_shift</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">line_Y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="Fix8.calculate_fixation_report">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.calculate_fixation_report">[docs]</a>
    <span class="k">def</span> <span class="nf">calculate_fixation_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># get save file name</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">default_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_fixation_report.csv&#39;</span>
        <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Save Fixations Report&quot;</span><span class="p">,</span> <span class="n">default_file_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># get fixations from self.eye_events dataframe, filter by eye_event == &quot;fixation&quot;</span>
        <span class="n">fixation_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_events</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eye_events</span><span class="p">[</span><span class="s2">&quot;eye_event&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;fixation&quot;</span><span class="p">]</span>

        <span class="n">fixation_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>



<div class="viewcode-block" id="Fix8.calculate_saccade_report">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.calculate_saccade_report">[docs]</a>
    <span class="k">def</span> <span class="nf">calculate_saccade_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># get save file name</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">default_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_saccade_report.csv&#39;</span>
        <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Save Saccades Report&quot;</span><span class="p">,</span> <span class="n">default_file_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># get saccades from self.eye_events dataframe, filter by eye_event == &quot;saccade&quot;</span>
        <span class="n">saccade_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_events</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eye_events</span><span class="p">[</span><span class="s2">&quot;eye_event&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;saccade&quot;</span><span class="p">]</span>

        <span class="n">saccade_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>



<div class="viewcode-block" id="Fix8.calculate_aoi_report">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.calculate_aoi_report">[docs]</a>
    <span class="k">def</span> <span class="nf">calculate_aoi_report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># open hit test dialog to get radius</span>
        <span class="n">default_radius</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">minimum_value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">maximum_value</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">radius</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Radius&quot;</span><span class="p">,</span> <span class="s2">&quot;Enter inclusion radius for hit test (pixels)&quot;</span><span class="p">,</span> <span class="n">default_radius</span><span class="p">,</span> <span class="n">minimum_value</span><span class="p">,</span> <span class="n">maximum_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No radius selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># get save file name</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">default_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_AOI_report.csv&#39;</span>
        <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Save AOI Report&quot;</span><span class="p">,</span> <span class="n">default_file_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="n">hit_test_data</span> <span class="o">=</span> <span class="n">mini_emtk</span><span class="o">.</span><span class="n">hit_test</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span>
    
        <span class="c1"># write hit test data to file</span>
        <span class="n">hit_test_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Fix8.calculate_aoi_metrics">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.calculate_aoi_metrics">[docs]</a>
    <span class="k">def</span> <span class="nf">calculate_aoi_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># open hit test dialog to get radius</span>
        <span class="n">default_radius</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">minimum_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">maximum_value</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">radius</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Radius&quot;</span><span class="p">,</span> <span class="s2">&quot;Enter inclusion radius for hit test (pixels)&quot;</span><span class="p">,</span> <span class="n">default_radius</span><span class="p">,</span> <span class="n">minimum_value</span><span class="p">,</span> <span class="n">maximum_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No radius selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># get save file name</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">default_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_AOI_metrics.csv&#39;</span>
        <span class="n">file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Save AOI Metrics Report&quot;</span><span class="p">,</span> <span class="n">default_file_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">file_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="c1"># run hit test</span>
        <span class="n">hit_test_data</span> <span class="o">=</span> <span class="n">mini_emtk</span><span class="o">.</span><span class="n">hit_test</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span>

        <span class="n">single_fixation_duration</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first_fixation_duration</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">gaze_duration</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_time</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fixation_count</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">eye_metrics_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="c1"># get part and line from row index</span>
            <span class="n">token_line_part</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">line</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">token_line_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">part</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">token_line_part</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">])</span>

            <span class="c1"># convert line and part columns in hit_test_data to int</span>
            <span class="n">hit_test_data</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hit_test_data</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">hit_test_data</span><span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hit_test_data</span><span class="p">[</span><span class="s1">&#39;part&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="n">single_fixation_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mini_emtk</span><span class="o">.</span><span class="n">get_single_fixation_duration</span><span class="p">(</span><span class="n">hit_test_data</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">part</span><span class="p">))</span>
            <span class="n">first_fixation_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mini_emtk</span><span class="o">.</span><span class="n">get_first_fixation_duration</span><span class="p">(</span><span class="n">hit_test_data</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">part</span><span class="p">))</span>
            <span class="n">gaze_duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mini_emtk</span><span class="o">.</span><span class="n">get_gaze_duration</span><span class="p">(</span><span class="n">hit_test_data</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">part</span><span class="p">))</span>
            <span class="n">total_time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mini_emtk</span><span class="o">.</span><span class="n">get_total_time</span><span class="p">(</span><span class="n">hit_test_data</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">part</span><span class="p">))</span>
            <span class="n">fixation_count</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mini_emtk</span><span class="o">.</span><span class="n">get_fixation_count</span><span class="p">(</span><span class="n">hit_test_data</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">part</span><span class="p">))</span>

        <span class="n">eye_metrics_data</span><span class="p">[</span><span class="s1">&#39;single_fixation_duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">single_fixation_duration</span>
        <span class="n">eye_metrics_data</span><span class="p">[</span><span class="s1">&#39;first_fixation_duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">first_fixation_duration</span>
        <span class="n">eye_metrics_data</span><span class="p">[</span><span class="s1">&#39;gaze_duration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gaze_duration</span>
        <span class="n">eye_metrics_data</span><span class="p">[</span><span class="s1">&#39;total_time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_time</span>
        <span class="n">eye_metrics_data</span><span class="p">[</span><span class="s1">&#39;fixation_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fixation_count</span>
    
        <span class="c1"># write eye metrics data to file</span>
        <span class="n">eye_metrics_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

        
    

<div class="viewcode-block" id="Fix8.ascii_to_csv_converter">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.ascii_to_csv_converter">[docs]</a>
    <span class="k">def</span> <span class="nf">ascii_to_csv_converter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># open ascii file through file dialog limit to .asc files</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">ascii_file</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Select ascii file&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;ASCII Files (*.asc)&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">ascii_file</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># ask user for file name to save csv through file dialog</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">default_file_name</span> <span class="o">=</span> <span class="n">ascii_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.asc&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>
        <span class="n">new_correction_file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Save converted CSV file&quot;</span><span class="p">,</span> <span class="n">default_file_name</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">new_correction_file_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s1">&#39;.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_correction_file_name</span><span class="p">:</span>
            <span class="n">new_correction_file_name</span> <span class="o">+=</span> <span class="s1">&#39;.csv&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">,</span> <span class="s2">&quot;Conversion may take a while&quot;</span><span class="p">)</span>

        <span class="c1"># convert and save csv file</span>
        <span class="n">mini_emtk</span><span class="o">.</span><span class="n">read_EyeLink1000</span><span class="p">(</span><span class="n">ascii_file</span><span class="p">,</span> <span class="n">new_correction_file_name</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.json_to_csv_converter">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.json_to_csv_converter">[docs]</a>
    <span class="k">def</span> <span class="nf">json_to_csv_converter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># open json file through file dialog limit to .asc files</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">json_file</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Select Json file&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Json Files (*.json)&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">json_file</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># ask user for file name to save csv through file dialog</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">default_file_name</span> <span class="o">=</span> <span class="n">json_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>
        <span class="n">new_correction_file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Save converted CSV file&quot;</span><span class="p">,</span> <span class="n">default_file_name</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">new_correction_file_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s1">&#39;.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_correction_file_name</span><span class="p">:</span>
            <span class="n">new_correction_file_name</span> <span class="o">+=</span> <span class="s1">&#39;.csv&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">,</span> <span class="s2">&quot;Conversion may take a while&quot;</span><span class="p">)</span>

        <span class="c1"># convert and save csv file</span>
        <span class="n">dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_to_df</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
        <span class="n">dataframe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">new_correction_file_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.csv_to_json_converter">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.csv_to_json_converter">[docs]</a>
    <span class="k">def</span> <span class="nf">csv_to_json_converter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># open csv file through file dialog limit to .asc files</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">csv_file</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Select CSV file&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;CSV Files (*.csv)&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">csv_file</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># ask user for file name to save csv through file dialog</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">default_file_name</span> <span class="o">=</span> <span class="n">csv_file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span>
        <span class="n">new_correction_file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Save converted json file&quot;</span><span class="p">,</span> <span class="n">default_file_name</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">new_correction_file_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s1">&#39;.json&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_correction_file_name</span><span class="p">:</span>
            <span class="n">new_correction_file_name</span> <span class="o">+=</span> <span class="s1">&#39;.json&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">,</span> <span class="s2">&quot;Conversion may take a while&quot;</span><span class="p">)</span>

        <span class="c1"># convert and save csv file</span>
        <span class="n">dataframe</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">)</span>

        <span class="c1"># get the fixations from the csv file</span>
        <span class="n">fixation_data</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">dataframe</span><span class="p">[</span><span class="s2">&quot;eye_event&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;fixation&quot;</span><span class="p">]</span>
        <span class="n">fixations</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># get the x, y, and duration of the fixations</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">fixation_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">fixations</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;x_cord&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;y_cord&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]])</span>

        <span class="n">corrected_fixations</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fixations&#39;</span><span class="p">:</span> <span class="n">fixations</span><span class="p">}</span>
        <span class="c1"># for i in range(len(fixations)):</span>
        <span class="c1">#     corrected_fixations[i + 1] = fixations[i]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_correction_file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">corrected_fixations</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span></div>

        


<div class="viewcode-block" id="Fix8.eyelink_experiment_to_csv_converter">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.eyelink_experiment_to_csv_converter">[docs]</a>
    <span class="k">def</span> <span class="nf">eyelink_experiment_to_csv_converter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; convert eyelink experiment to csv files from ASCII and runtime folder &#39;&#39;&#39;</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">ecd</span><span class="o">.</span><span class="n">EyelinkDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">)</span>

        <span class="c1"># get user inputs</span>
        <span class="n">ascii_file</span><span class="p">,</span> <span class="n">runtime_folder</span><span class="p">,</span> <span class="n">save_folder</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">getInputs</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ascii_file</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">runtime_folder</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">save_folder</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;Required fields are missing&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Warning&quot;</span><span class="p">,</span> <span class="s2">&quot;Conversion may take a while&quot;</span><span class="p">)</span>
        <span class="n">mini_emtk</span><span class="o">.</span><span class="n">read_EyeLink1000_experiment</span><span class="p">(</span><span class="n">ascii_file</span><span class="p">,</span> <span class="n">save_folder</span><span class="p">,</span> <span class="n">runtime_folder</span><span class="o">=</span><span class="n">runtime_folder</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.outlier_duration_filter">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.outlier_duration_filter">[docs]</a>
    <span class="k">def</span> <span class="nf">outlier_duration_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">minimum_value</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">maximum_value</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="mf">2.5</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Duration Filter&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Remove fixations with durations X standard deviations away from the mean&quot;</span>
        <span class="n">threshold</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getDouble</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">minimum_value</span><span class="p">,</span> <span class="n">maximum_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;filter,removed fixations X standard deviations away from the mean &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>

        <span class="c1"># get mean duration and standard deviation</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>

        <span class="c1"># remove fixations X standard deviations away from the mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[((</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">!=</span> <span class="s2">&quot;manual&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mean</span> <span class="o">+</span> <span class="n">threshold</span> <span class="o">*</span> <span class="n">std</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_trial_statistics</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.undo">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.undo">[docs]</a>
    <span class="k">def</span> <span class="nf">undo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; implement undo using memento pattern and state class &#39;&#39;&#39;</span> 
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_history</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
            
            <span class="n">at_max</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># check if progressbar is at end of progressbar range</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">maximum</span><span class="p">():</span>
                <span class="n">at_max</span> <span class="o">=</span> <span class="kc">True</span>
             
            <span class="n">fix8_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_history</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">saccades</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">blinks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span> <span class="o">=</span> <span class="n">fix8_state</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>

            <span class="c1"># update progress bar</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="ow">or</span> <span class="n">at_max</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_trial_statistics</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.save_state">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.save_state">[docs]</a>
    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">current_state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">Fix8State</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saccades</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blinks</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_history</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">current_state</span><span class="p">)</span></div>



<div class="viewcode-block" id="Fix8.outside_screen_filter">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.outside_screen_filter">[docs]</a>
    <span class="k">def</span> <span class="nf">outside_screen_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="s2">&quot;filter,removed fixations outside screen,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="c1"># get image dimentions from self.image_file_path</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_file_path</span><span class="p">)</span>
        <span class="n">screen_width</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">screen_height</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">screen_width</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">screen_height</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">!=</span> <span class="s2">&quot;manual&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">screen_width</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">screen_height</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw_canvas</span><span class="p">(</span><span class="n">draw_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_trial_statistics</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.lowpass_duration_filter">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.lowpass_duration_filter">[docs]</a>
    <span class="k">def</span> <span class="nf">lowpass_duration_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">minimum_value</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">maximum_value</span> <span class="o">=</span> <span class="mi">101</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="mi">80</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Duration Filter&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Remove fixations with durations less than&quot;</span>
        <span class="n">threshold</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">minimum_value</span><span class="p">,</span> <span class="n">maximum_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;filter,removed fixations less than &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">threshold</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">!=</span> <span class="s2">&quot;manual&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">threshold</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw_canvas</span><span class="p">(</span><span class="n">draw_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_trial_statistics</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.highpass_duration_filter">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.highpass_duration_filter">[docs]</a>
    <span class="k">def</span> <span class="nf">highpass_duration_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">minimum_value</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">maximum_value</span> <span class="o">=</span> <span class="mi">2000</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="mi">800</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Duration Filter&quot;</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Remove fixations with durations greater than&quot;</span>
        <span class="n">threshold</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">minimum_value</span><span class="p">,</span> <span class="n">maximum_value</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;filter,removed fixations greater than &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">threshold</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">!=</span> <span class="s2">&quot;manual&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">int</span><span class="p">(</span><span class="n">threshold</span><span class="p">)]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw_canvas</span><span class="p">(</span><span class="n">draw_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_trial_statistics</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.merge_fixations">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.merge_fixations">[docs]</a>
    <span class="k">def</span> <span class="nf">merge_fixations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dialog</span> <span class="o">=</span> <span class="n">mfd</span><span class="o">.</span><span class="n">MergeFixationsDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">)</span>
        <span class="n">dialog</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
        
        <span class="n">duration_threshold</span><span class="p">,</span> <span class="n">dispersion_threshold</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">getInputs</span><span class="p">()</span>
        <span class="c1"># check empty</span>
        <span class="k">if</span> <span class="n">duration_threshold</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">dispersion_threshold</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span>
        
        <span class="c1"># check ints</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">duration_threshold</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration_threshold</span><span class="p">)</span>
            <span class="n">dispersion_threshold</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dispersion_threshold</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span>
    
        <span class="c1"># write metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;filter,merge fixations less than &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">duration_threshold</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;, dispersion_threshold&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dispersion_threshold</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot;, &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>

        <span class="c1"># merge fixations</span>
        <span class="n">new_fixations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            
            <span class="c1"># if either fixation is short and distance is small, merge</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">new_fixations</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">duration_threshold</span> <span class="ow">or</span> <span class="n">new_fixations</span><span class="p">[</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">duration_threshold</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">mini_emtk</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">new_fixations</span><span class="p">[</span><span class="n">index</span><span class="p">],</span> <span class="n">new_fixations</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">dispersion_threshold</span><span class="p">):</span>

                <span class="n">new_fixations</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">new_fixations</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">new_fixations</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_fixations</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">!=</span> <span class="s2">&quot;manual&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_correction</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw_canvas</span><span class="p">(</span><span class="n">draw_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_trial_statistics</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.run_correction">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.run_correction">[docs]</a>
    <span class="k">def</span> <span class="nf">run_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">fixation_XY</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span>
        <span class="n">fixation_XY</span> <span class="o">=</span> <span class="n">fixation_XY</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">fixation_XY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fixation_XY</span><span class="p">)</span>
        <span class="n">line_Y</span> <span class="o">=</span> <span class="n">mini_emtk</span><span class="o">.</span><span class="n">find_lines_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">)</span>
        <span class="n">line_Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">line_Y</span><span class="p">)</span>
        <span class="n">word_XY</span> <span class="o">=</span> <span class="n">mini_emtk</span><span class="o">.</span><span class="n">find_word_centers</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">)</span>
        <span class="n">word_XY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">word_XY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span>

        <span class="c1"># run algorithm, warp uses word_xy, others use line_Y</span>
        <span class="k">if</span> <span class="s2">&quot;warp&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm_function</span><span class="p">(</span><span class="n">fixation_XY</span><span class="p">,</span> <span class="n">line_Y</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="s2">&quot;+&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">:</span>
            <span class="c1"># hybrid</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm_function</span><span class="p">(</span><span class="n">fixation_XY</span><span class="p">,</span> <span class="n">line_Y</span><span class="p">,</span> <span class="n">word_XY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">secondery_algorithm_function</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># warp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm_function</span><span class="p">(</span><span class="n">fixation_XY</span><span class="p">,</span> <span class="n">word_XY</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">+</span> <span class="s2">&quot; Algorithm Selected&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">relevant_buttons</span><span class="p">(</span><span class="s2">&quot;algorithm_selected&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Fix8.run_algorithm">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.run_algorithm">[docs]</a>
    <span class="k">def</span> <span class="nf">run_algorithm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">algorithm_name</span><span class="p">,</span> <span class="n">algorithm_function</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">secondery_algorithm_function</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="n">algorithm_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm_function</span> <span class="o">=</span> <span class="n">algorithm_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secondery_algorithm_function</span> <span class="o">=</span> <span class="n">secondery_algorithm_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_correction</span><span class="p">()</span>

        <span class="c1"># write metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;selected, algorithm &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;semi&#39;</span><span class="p">:</span>
            <span class="c1"># show suggestion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_suggestion</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_suggestion</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_suggestion</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="c1"># update progress bar to end</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">minimum</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># correct all</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">correct_all_fixations</span><span class="p">()</span>
            <span class="c1"># hide suggestion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_suggestion</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_suggestion</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_suggestion</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># update progress bar to end</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">maximum</span><span class="p">())</span></div>



<div class="viewcode-block" id="Fix8.manual_correction">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.manual_correction">[docs]</a>
    <span class="k">def</span> <span class="nf">manual_correction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm_function</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secondery_algorithm_function</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="s2">&quot;manual&quot;</span>

        <span class="c1"># write metadata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;selected, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_suggestion</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># hide suggestion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_suggestion</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


    
<div class="viewcode-block" id="Fix8.get_selected_fixation">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.get_selected_fixation">[docs]</a>
    <span class="k">def</span> <span class="nf">get_selected_fixation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the selected fixation that the user picks, with the selection </span>
<span class="sd">        inside a specific diameter range (epsilon), selected_fixation is an </span>
<span class="sd">        index, not the actual scatter point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixation_points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_points</span><span class="o">.</span><span class="n">get_offsets</span><span class="p">())</span>
            <span class="n">xyt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">)</span>
            <span class="n">xt</span><span class="p">,</span> <span class="n">yt</span> <span class="o">=</span> <span class="n">xyt</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xyt</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">xt</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">yt</span> <span class="o">-</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c1">#self.selected_fixation = d.argmin()</span>

            <span class="k">for</span> <span class="n">fixation_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)):</span> 

                <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="n">fixation_index</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                <span class="c1">#epsilon = 11  # diameter range</span>
                <span class="n">area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixation_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">duration</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

                <span class="c1"># divide are a by pi and take the square root to get the radius</span>
                <span class="n">epsilon</span> <span class="o">=</span> <span class="p">(</span><span class="n">area</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>

                <span class="k">if</span> <span class="n">epsilon</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="n">epsilon</span> <span class="o">=</span> <span class="mi">5</span>

                <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">fixation_index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="mf">0.91</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span> <span class="o">=</span> <span class="n">fixation_index</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span>
            
            <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="Fix8.move_left_selected_fixation">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.move_left_selected_fixation">[docs]</a>
    <span class="k">def</span> <span class="nf">move_left_selected_fixation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw_canvas</span><span class="p">()</span></div>


<div class="viewcode-block" id="Fix8.move_right_selected_fixation">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.move_right_selected_fixation">[docs]</a>
    <span class="k">def</span> <span class="nf">move_right_selected_fixation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw_canvas</span><span class="p">()</span></div>


<div class="viewcode-block" id="Fix8.move_down_selected_fixation">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.move_down_selected_fixation">[docs]</a>
    <span class="k">def</span> <span class="nf">move_down_selected_fixation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw_canvas</span><span class="p">()</span></div>


<div class="viewcode-block" id="Fix8.move_up_selected_fixation">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.move_up_selected_fixation">[docs]</a>
    <span class="k">def</span> <span class="nf">move_up_selected_fixation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw_canvas</span><span class="p">()</span></div>


<div class="viewcode-block" id="Fix8.button_press_callback">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.button_press_callback">[docs]</a>
    <span class="k">def</span> <span class="nf">button_press_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_selected_fixation</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

        <span class="c1"># print(self.selected_fixation)</span>


<div class="viewcode-block" id="Fix8.button_release_callback">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.button_release_callback">[docs]</a>
    <span class="k">def</span> <span class="nf">button_release_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;when released the fixation after a move, update the fixations&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="c1"># write metadata</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;manual_moving, fixation &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot; moved from x:&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="o">+</span> <span class="s2">&quot; y:&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="o">+</span> <span class="s2">&quot; to x:&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="o">+</span> <span class="s2">&quot; y:&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>

            <span class="c1"># move fixation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># update correction based on algorithm</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">!=</span> <span class="s2">&quot;manual&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run_correction</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_saccades</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_saccades</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># self.selected_fixation = None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">()</span></div>

        <span class="c1">#self.draw_canvas()</span>
        <span class="c1"># self.ui.canvas.update()</span>

<div class="viewcode-block" id="Fix8.motion_notify_callback">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.motion_notify_callback">[docs]</a>
    <span class="k">def</span> <span class="nf">motion_notify_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; called when fixation is being dragged &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>

        <span class="c1">#self.xy = np.asarray(self.scatter.get_offsets())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked_x</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
        <span class="c1">#self.scatter.set_offsets(self.xy)</span>
        <span class="c1"># self.ui.canvas.draw_idle()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">restore_region</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_points</span><span class="p">)</span>
        <span class="c1">#self.ui.canvas.ax.draw_artist(self.saccades)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.lock_x_axis">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.lock_x_axis">[docs]</a>
    <span class="k">def</span> <span class="nf">lock_x_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked_x</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locked_x</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lock_x_axis_action</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Lock X Axis&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locked_x</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">lock_x_axis_action</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Unlock X Axis&quot;</span><span class="p">)</span>

        <span class="k">pass</span></div>



<div class="viewcode-block" id="Fix8.keyPressEvent">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.keyPressEvent">[docs]</a>
    <span class="k">def</span> <span class="nf">keyPressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="p">(),</span> <span class="s1">&#39;pressed&#39;</span><span class="p">)</span>
        <span class="c1"># j: move to the left is 74</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="mi">74</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">move_left_selected_fixation</span><span class="p">()</span>

        <span class="c1"># l: move to the right is 76</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="mi">76</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">move_right_selected_fixation</span><span class="p">()</span>

        <span class="c1"># k: move down is 75</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="mi">75</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">move_down_selected_fixation</span><span class="p">()</span>

        <span class="c1"># i: move up is 73</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="mi">73</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">move_up_selected_fixation</span><span class="p">()</span>

        <span class="c1"># a: next is 65</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="mi">65</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">button_next_fixation</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="s2">&quot;key,next,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="c1">#self.next_fixation()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a pressed&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assign_fixation_above</span><span class="p">()</span>

        <span class="c1"># z: back is 90</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="mi">90</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">button_previous_fixation</span><span class="o">.</span><span class="n">isEnabled</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="s2">&quot;key,previous,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="c1">#self.previous_fixation()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assign_fixation_below</span><span class="p">()</span>

        <span class="c1"># spacebar: accept and next is 32</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="mi">32</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithm_function</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="s2">&quot;key,accept suggestion,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">confirm_suggestion</span><span class="p">()</span>

        <span class="c1"># backspace</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="o">==</span> <span class="mi">16777219</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="s2">&quot;key,remove fixation,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove_fixation</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.remove_fixation">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.remove_fixation">[docs]</a>
    <span class="k">def</span> <span class="nf">remove_fixation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># delete the row of selected fixation</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">-=</span> <span class="mi">1</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># delete the row of selected fixation</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">selected_fixation</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">draw_canvas</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>



<div class="viewcode-block" id="Fix8.show_error_message">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.show_error_message">[docs]</a>
    <span class="k">def</span> <span class="nf">show_error_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window_title</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">qmb</span> <span class="o">=</span> <span class="n">QMessageBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">)</span>
        <span class="n">qmb</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">window_title</span><span class="p">)</span>
        <span class="n">qmb</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="n">qmb</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.open_trial_folder">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.open_trial_folder">[docs]</a>
    <span class="k">def</span> <span class="nf">open_trial_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;open trial folder, display it to trial list window with list of JSON trials&quot;&quot;&quot;</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getExistingDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Select Folder&quot;</span><span class="p">)</span>

        <span class="c1"># --- make sure a folder was actually chosen, otherwise just cancel ---</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="c1"># clear the data since a new folder was open, no trial is chosen at this point</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">trial_list</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_fixations</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_saccades</span><span class="p">()</span>

            <span class="c1"># when open a new folder, block off all the relevant buttons that shouldn&#39;t be accesible until a trial is clicked</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">relevant_buttons</span><span class="p">(</span><span class="s2">&quot;opened_folder&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span> <span class="s2">&quot;Trial Folder Opened: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="p">)</span>

            <span class="n">files</span> <span class="o">=</span> <span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span><span class="p">)</span>

            <span class="n">image_file</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_AOI.csv&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_hit_test.csv&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span><span class="p">)</span>

                    <span class="k">elif</span> <span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.png&quot;</span><span class="p">)</span>
                        <span class="ow">or</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.jpeg&quot;</span><span class="p">)</span>
                        <span class="ow">or</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">)):</span>
                        <span class="k">if</span> <span class="n">image_file</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>  <span class="c1"># only get the first image found</span>
                            <span class="n">image_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">image_file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">file</span>
                
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># add the files to the trial list window</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">trials</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_list</span><span class="p">:</span>
                        <span class="n">file_to_add</span> <span class="o">=</span> <span class="n">QListWidgetItem</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
                        <span class="n">file_to_add_name</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># last part of file text</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">[</span><span class="n">file_to_add_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">file</span>
                        <span class="n">file_to_add</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">file_to_add_name</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">trial_list</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">file_to_add</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Trial Folder Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No JSONS&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Trial Folder Error&quot;</span><span class="p">,</span> <span class="s2">&quot;Empty Folder&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">image_file</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>  <span class="c1"># image file wasn&#39;t found</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Trial Folder Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No Compatible Image&quot;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># clear self.ui.canvas</span>
                <span class="c1">#self.ui.canvas.clear()</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">set_canvas_image</span><span class="p">(</span><span class="n">image_file</span><span class="p">)</span>
                <span class="c1">#self.ui.canvas.background = self.ui.canvas.copy_from_bbox(self.ui.canvas.ax.bbox)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                <span class="c1">#self.draw_canvas()</span>
                <span class="c1">#self.ui.canvas.draw_idle()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">find_aoi</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">relevant_buttons</span><span class="p">(</span><span class="s2">&quot;opened_stimulus&quot;</span><span class="p">)</span>
                <span class="c1"># hide side panel until a folder is opened</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">show_side_panel</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.open_image">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.open_image">[docs]</a>
    <span class="k">def</span> <span class="nf">open_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_file_path</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Select Image&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Image Files (*.png *.jpg *.jpeg)&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_file_path</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_canvas_image</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_file_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">find_aoi</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">relevant_buttons</span><span class="p">(</span><span class="s2">&quot;opened_stimulus&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">generate_menu</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">open_trial_action</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">open_aoi_action</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Image Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No Image Selected&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.open_trial">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.open_trial">[docs]</a>
    <span class="k">def</span> <span class="nf">open_trial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Select Trial file&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;CSV or Json (*.csv *.json)&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_file_path</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Image Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No Image Selected&quot;</span><span class="p">)</span>
        
        <span class="c1"># reset times saved if a DIFFERENT trial was selected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">):</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_json_fixations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trial_name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">):</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_csv_fixations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trial_name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span>

        <span class="c1"># clear history for undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_history</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">History</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  

        <span class="c1"># set the progress bar to the amount of fixations found</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="s2">&quot;started, open trial,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label_progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;0/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label_progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_fixations</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_saccades</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_canvas</span><span class="p">(</span><span class="n">draw_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_name</span> <span class="o">+</span> <span class="s2">&quot; Opened (Default: Manual Mode)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_trial_statistics</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.update_trial_statistics">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.update_trial_statistics">[docs]</a>
    <span class="k">def</span> <span class="nf">update_trial_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># eye events has a timestamp column, find the duration of the trial by subtracting the first and last timestamp</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_events</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;time_stamp&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_events</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_events</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;time_stamp&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_events</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;time_stamp&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statistics_table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">duration</span><span class="o">//</span><span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; sec&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statistics_table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">))</span>

        <span class="c1"># get maximum fixation duration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statistics_table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statistics_table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">))</span>

        <span class="c1"># get minimum fixation duration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statistics_table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statistics_table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">))</span>

        <span class="c1"># get the number of aois</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statistics_table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statistics_table</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">QTableWidgetItem</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">))</span></div>


        <span class="c1"># if self.current_fixation is not None:</span>
        <span class="c1">#     self.ui.statistics_table.setItem(5, 1, QTableWidgetItem(str(self.fixations[self.current_fixation])))</span>

        <span class="c1">#self.ui.statistics_table.setHidden(False)</span>



<div class="viewcode-block" id="Fix8.open_aoi">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.open_aoi">[docs]</a>
    <span class="k">def</span> <span class="nf">open_aoi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">aoi_file</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Select AOI&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;AOI Files (*.csv)&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        
        <span class="k">if</span> <span class="n">aoi_file</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No aoi file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_file_path</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Image Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No Image Selected&quot;</span><span class="p">)</span>

        <span class="c1"># open aoi file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">aoi_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>

        <span class="c1"># draw canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_canvas</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_name</span> <span class="o">+</span> <span class="s2">&quot; Opened (Default: Manual Mode)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_trial_statistics</span><span class="p">()</span></div>




<div class="viewcode-block" id="Fix8.set_canvas_image">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.set_canvas_image">[docs]</a>
    <span class="k">def</span> <span class="nf">set_canvas_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_file</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">mpimg</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">image_file</span><span class="p">)</span>
        <span class="c1"># show image with highest quality</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;hanning&quot;</span><span class="p">)</span></div>

        <span class="c1">#self.ui.canvas.ax.set_title(str(image_file.split(&#39;/&#39;)[-1].split(&quot;.&quot;)[0]))</span>


<div class="viewcode-block" id="Fix8.trial_double_clicked">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.trial_double_clicked">[docs]</a>
    <span class="k">def</span> <span class="nf">trial_double_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        when a trial from the trial list is double clicked, find the fixations of the trial</span>
<span class="sd">        parameters:</span>
<span class="sd">        item - the value passed through when clicking a trial object in the list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># reset times saved if a DIFFERENT trial was selected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial_name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trials</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">):</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_json_fixations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trial_name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.csv&quot;</span><span class="p">):</span>
            <span class="n">ok</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_csv_fixations</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trial_name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span>

        <span class="c1"># clear history for undo</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_history</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">History</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>  

        <span class="c1"># set the progress bar to the amount of fixations found</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer_start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="s2">&quot;started,,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label_progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;0/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label_progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_fixations</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_saccades</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_canvas</span><span class="p">(</span><span class="n">draw_all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_name</span> <span class="o">+</span> <span class="s2">&quot; Opened (Default: Manual Mode)&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_trial_statistics</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.find_aoi">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.find_aoi">[docs]</a>
    <span class="k">def</span> <span class="nf">find_aoi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;find the areas of interest (aoi) for the selected stimulus&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_file_path</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_color</span> <span class="o">=</span> <span class="n">mini_emtk</span><span class="o">.</span><span class="n">EMTK_find_aoi</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">image_file_path</span><span class="p">,</span>
                <span class="n">margin_height</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi_height</span><span class="p">,</span>
                <span class="n">margin_width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi_width</span><span class="p">,</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.json_to_df">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.json_to_df">[docs]</a>
    <span class="k">def</span> <span class="nf">json_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial_path</span><span class="p">):</span>
        <span class="n">x_cord</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y_cord</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">trial_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">trial</span><span class="p">:</span>

            <span class="n">trial_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">trial</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;fixations&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">trial_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c1"># old JSON format</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">trial_data</span><span class="p">:</span>
                    <span class="n">x_cord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trial_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">y_cord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trial_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trial_data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># new JSON format</span>
                <span class="k">for</span> <span class="n">fixation</span> <span class="ow">in</span> <span class="n">trial_data</span><span class="p">[</span><span class="s2">&quot;fixations&quot;</span><span class="p">]:</span>
                    <span class="n">x_cord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fixation</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">y_cord</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fixation</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">duration</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fixation</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

        <span class="c1"># create an empty dataframe</span>
        <span class="n">eye_events</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x_cord&quot;</span><span class="p">,</span> <span class="s2">&quot;y_cord&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">])</span>
        <span class="n">eye_events</span><span class="p">[</span><span class="s2">&quot;x_cord&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_cord</span>
        <span class="n">eye_events</span><span class="p">[</span><span class="s2">&quot;y_cord&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_cord</span>
        <span class="n">eye_events</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">duration</span>
        <span class="n">eye_events</span><span class="p">[</span><span class="s2">&quot;eye_event&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fixation&quot;</span>

        <span class="k">return</span> <span class="n">eye_events</span></div>

    
<div class="viewcode-block" id="Fix8.read_json_fixations">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.read_json_fixations">[docs]</a>
    <span class="k">def</span> <span class="nf">read_json_fixations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;find all the fixations of the trial that was double clicked</span>
<span class="sd">        parameters:</span>
<span class="sd">        trial_path - the trial file path of the trial clicked on&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eye_events</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">json_to_df</span><span class="p">(</span><span class="n">trial_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_events</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;eye_event&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Trial File Error&quot;</span><span class="p">,</span> <span class="s2">&quot;Problem reading CSV File&quot;</span><span class="p">)</span>     
            <span class="k">return</span> <span class="kc">False</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">relevant_buttons</span><span class="p">(</span><span class="s2">&quot;trial_clicked&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>



<div class="viewcode-block" id="Fix8.read_csv_fixations">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.read_csv_fixations">[docs]</a>
    <span class="k">def</span> <span class="nf">read_csv_fixations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;find all the fixations of the trial that was double clicked</span>
<span class="sd">        parameters:</span>
<span class="sd">        trial_path - the trial file path of the trial clicked on&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># open the csv file with pandas</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eye_events</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">trial_path</span><span class="p">)</span>
            
            <span class="c1"># get the fixations from the csv file</span>
            <span class="n">fixations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eye_events</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">eye_events</span><span class="p">[</span><span class="s2">&quot;eye_event&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;fixation&quot;</span><span class="p">]</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Trial File Error&quot;</span><span class="p">,</span> <span class="s2">&quot;Problem reading CSV File&quot;</span><span class="p">)</span>     
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># get the x, y, and duration of the fixations</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">fixations</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;x_cord&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;y_cord&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">relevant_buttons</span><span class="p">(</span><span class="s2">&quot;trial_clicked&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    

<div class="viewcode-block" id="Fix8.clear_saccades">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.clear_saccades">[docs]</a>
    <span class="k">def</span> <span class="nf">clear_saccades</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;remove the saccades from the canvas (this does not erase the data, just visuals)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">saccade_lines</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># &lt;-- if this line crashes the tool</span>

            <span class="c1"># for line in self.ui.canvas.ax.lines:  #&lt;-- use this instead</span>
            <span class="c1">#    line.remove()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">saccade_lines</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.clear_fixations">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.clear_fixations">[docs]</a>
    <span class="k">def</span> <span class="nf">clear_fixations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;clear the fixations from the canvas&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixation_points</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># self.scatter.remove()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixation_points</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1"># clear scatter data from canvas but not the background image</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">collections</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>  <span class="c1"># &lt;-- If this line crashes the tool</span>

            <span class="c1"># for collection in self.ui.canvas.ax.collections: #&lt;-- use this instead</span>
            <span class="c1">#    collection.remove()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>


    
<div class="viewcode-block" id="Fix8.clear_aois">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.clear_aois">[docs]</a>
    <span class="k">def</span> <span class="nf">clear_aois</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;clear the areas of interest from the canvas&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">patches</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>




    <span class="c1"># draw fixations2 is similar to the normal draw fixations, excpet this one only draws to the current fixation</span>
<div class="viewcode-block" id="Fix8.draw_canvas">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.draw_canvas">[docs]</a>
    <span class="k">def</span> <span class="nf">draw_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">draw_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">draw_all</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

        <span class="c1"># get rid of the data before updating it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_fixations</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_saccades</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_aois</span><span class="p">()</span>
        

        <span class="c1"># update the scatter based on the progress bar, redraw the canvas if checkbox is clicked</span>
        <span class="c1"># do the same for saccades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_fixations</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_fixations</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">list_colors</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_color</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">list_colors</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation_color</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fixation_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">duration</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.8</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_opacity</span><span class="p">,</span>
                    <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">copy_from_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_saccades</span><span class="o">.</span><span class="n">isCheckable</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_saccades</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">saccade_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">saccade_opacity</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">saccade_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">saccade_line_size</span>
                <span class="p">)</span>

        <span class="c1"># draw suggested fixation in blue</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_suggestion</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">suggested_fixation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">duration</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.8</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_opacity</span><span class="p">,</span>
                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_fixation_color</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># draw remaining fixations in grey</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_all_fixations</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">remaining_fixations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">duration</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.8</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_opacity</span><span class="p">,</span>
                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remaining_fixation_color</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># draw aois</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_aoi</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aoi_color</span> 


            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">xcord</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
                <span class="n">ycord</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
                <span class="n">height</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
                <span class="n">width</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
                <span class="n">aoi_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                    <span class="n">Rectangle</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">xcord</span><span class="p">,</span> <span class="n">ycord</span><span class="p">),</span>
                        <span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                        <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.quick_draw_canvas">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.quick_draw_canvas">[docs]</a>
    <span class="k">def</span> <span class="nf">quick_draw_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">all_fixations</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="c1"># TODO: temporary fix for the all_fixations bug, this should be fixed</span>
        <span class="k">if</span> <span class="n">all_fixations</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">all_fixations</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">background</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">copy_from_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">restore_region</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">background</span><span class="p">)</span>

        <span class="c1"># figure out which fixations to draw</span>
        <span class="k">if</span> <span class="n">all_fixations</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>


        <span class="c1"># draw fixations</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_fixations</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="c1"># generate colors for fixations</span>
            <span class="n">list_colors</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_color</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">list_colors</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation_color</span><span class="p">])</span>

            <span class="c1"># draw fixations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixation_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">y</span><span class="p">,</span>
                <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">duration</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.8</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_opacity</span><span class="p">,</span>
                <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_points</span><span class="p">)</span>

        <span class="c1"># draw saccades</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_saccades</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saccade_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">saccade_opacity</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">saccade_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">saccade_line_size</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saccade_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># draw suggested fixation in blue (or selected color)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_suggestion</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">suggested_fixation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="mi">30</span> <span class="o">*</span> <span class="p">(</span><span class="n">duration</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.8</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_opacity</span><span class="p">,</span>
                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_fixation_color</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_fixation</span><span class="p">)</span>

        <span class="c1"># draw remaining fixations and saccades in grey</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_all_fixations</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:,</span> <span class="mi">2</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">remaining_fixations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="p">,</span>
                    <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">duration</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span> <span class="o">**</span> <span class="mf">1.8</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_opacity</span><span class="p">,</span>
                    <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remaining_fixation_color</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remaining_fixations</span><span class="p">)</span>


                <span class="c1"># draw remaining saccades</span>
                <span class="c1"># x = self.fixations[self.current_fixation:, 0]</span>
                <span class="c1"># y = self.fixations[self.current_fixation:, 1] </span>
                <span class="n">saccade_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">saccade_opacity</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">remaining_fixation_color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">saccade_line_size</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">saccade_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># draw aois</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">checkbox_show_aoi</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>

                <span class="n">xcord</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;x&quot;</span><span class="p">]</span>
                <span class="n">ycord</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
                <span class="n">height</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
                <span class="n">width</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
                
                <span class="n">aoi_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                    <span class="n">Rectangle</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">xcord</span><span class="p">,</span> <span class="n">ycord</span><span class="p">),</span>
                        <span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                        <span class="n">edgecolor</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi_color</span><span class="p">,</span>
                        <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">draw_artist</span><span class="p">(</span><span class="n">aoi_box</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">blit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="p">)</span></div>



<div class="viewcode-block" id="Fix8.correct_all_fixations">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.correct_all_fixations">[docs]</a>
    <span class="k">def</span> <span class="nf">correct_all_fixations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;if the user presses the correct all fixations button,</span>
<span class="sd">        make the corrected fixations the suggested ones from the correction algorithm&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">)</span>
            <span class="c1">#self.draw_canvas()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">(</span><span class="n">all_fixations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;correct_all, all fixations corrected automatically&quot;</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span> <span class="s2">&quot;Correct All Fixations!&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.previous_fixation">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.previous_fixation">[docs]</a>
    <span class="k">def</span> <span class="nf">previous_fixation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># if self.suggested_corrections is not None:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>




<div class="viewcode-block" id="Fix8.next_fixation">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.next_fixation">[docs]</a>
    <span class="k">def</span> <span class="nf">next_fixation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_fixations</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Tour</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_canvas_image</span><span class="p">(</span><span class="s1">&#39;src/.images/fix8-tour-1.png&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">button_next_fixation</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>



<div class="viewcode-block" id="Fix8.assign_fixation_above">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.assign_fixation_above">[docs]</a>
    <span class="k">def</span> <span class="nf">assign_fixation_above</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;assign the fixation to the closest line above the current fixation&quot;&quot;&quot;</span>

        <span class="c1"># find the closest line above the current fixation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            
            <span class="n">line_Y</span> <span class="o">=</span> <span class="n">mini_emtk</span><span class="o">.</span><span class="n">find_lines_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">)</span>

            <span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_Y</span><span class="p">:</span>
                <span class="n">distances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">line</span><span class="p">)</span>

            <span class="n">closest_line</span> <span class="o">=</span> <span class="n">line_Y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">smallest_distance</span> <span class="o">=</span> <span class="mi">9999999</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">distance</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">distances</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">smallest_distance</span> <span class="ow">and</span> <span class="n">line_Y</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">smallest_distance</span> <span class="o">=</span> <span class="n">distance</span>
                    <span class="n">closest_line</span> <span class="o">=</span> <span class="n">line_Y</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">closest_line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">(</span><span class="n">all_fixations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_fixation</span><span class="p">()</span></div>

        

<div class="viewcode-block" id="Fix8.assign_fixation_below">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.assign_fixation_below">[docs]</a>
    <span class="k">def</span> <span class="nf">assign_fixation_below</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;assign the fixation to the closest line below the current fixation&quot;&quot;&quot;</span>

        <span class="c1"># find the closest line below the current fixation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">line_Y</span> <span class="o">=</span> <span class="n">mini_emtk</span><span class="o">.</span><span class="n">find_lines_y</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="p">)</span>

            <span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_Y</span><span class="p">:</span>
                <span class="n">distances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">line</span><span class="p">))</span>

            <span class="n">closest_line</span> <span class="o">=</span> <span class="n">line_Y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">smallest_distance</span> <span class="o">=</span> <span class="mi">9999999</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">distance</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">distances</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">smallest_distance</span> <span class="ow">and</span> <span class="n">line_Y</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">smallest_distance</span> <span class="o">=</span> <span class="n">distance</span>
                    <span class="n">closest_line</span> <span class="o">=</span> <span class="n">line_Y</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">closest_line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">(</span><span class="n">all_fixations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">next_fixation</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.confirm_suggestion">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.confirm_suggestion">[docs]</a>
    <span class="k">def</span> <span class="nf">confirm_suggestion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; when the confirm button is clicked, the suggested correction replaces the current fixation&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;auto_moving, fixation &quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">)</span>
            <span class="o">+</span> <span class="s2">&quot; moved from x:&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">+</span> <span class="s2">&quot; y:&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">+</span> <span class="s2">&quot; to x:&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="o">+</span> <span class="s2">&quot; y:&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">suggested_corrections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">(</span><span class="n">all_fixations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_fixation</span><span class="p">()</span></div>



<div class="viewcode-block" id="Fix8.save_metadata_file">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.save_metadata_file">[docs]</a>
    <span class="k">def</span> <span class="nf">save_metadata_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_correction_file_path</span><span class="p">):</span>
    
        <span class="n">metadata_file_name</span> <span class="o">=</span> <span class="n">new_correction_file_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_metadata.csv&#39;</span>
        <span class="n">metadata_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">metadata_file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="s2">&quot;event,event details,timestamp</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">metadata_file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">meta_file</span><span class="p">:</span>
                <span class="n">meta_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>
                <span class="n">meta_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span></div>



<div class="viewcode-block" id="Fix8.save_corrections_json">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.save_corrections_json">[docs]</a>
    <span class="k">def</span> <span class="nf">save_corrections_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; save correction to a json file and metadata to csv file &quot;&quot;&quot;</span>

        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">default_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_CORRECTED.json&#39;</span>
        <span class="n">new_correction_file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Save correction&quot;</span><span class="p">,</span> <span class="n">default_file_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_correction_file_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s1">&#39;.json&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_correction_file_name</span><span class="p">:</span>
            <span class="n">new_correction_file_name</span> <span class="o">+=</span> <span class="s1">&#39;.json&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="n">corrected_fixations</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fixations&#39;</span><span class="p">:</span> <span class="p">[]}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)):</span>
                <span class="n">corrected_fixations</span><span class="p">[</span><span class="s1">&#39;fixations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">new_correction_file_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">corrected_fixations</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                
            <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_start</span><span class="p">)</span>
            <span class="n">today</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;Saved,Date &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot; Trial Name&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_name</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot; File Path &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_correction_file_name</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot; Duration &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="c1">#self.save_metadata_file(new_correction_file_name)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span> <span class="s2">&quot;Corrections Saved to&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">new_correction_file_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Save Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No Corrections Made&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.save_corrections_csv">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.save_corrections_csv">[docs]</a>
    <span class="k">def</span> <span class="nf">save_corrections_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">default_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_CORRECTED.csv&#39;</span>
        <span class="n">new_correction_file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Save correction&quot;</span><span class="p">,</span> <span class="n">default_file_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_correction_file_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s1">&#39;.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_correction_file_name</span><span class="p">:</span>
            <span class="n">new_correction_file_name</span> <span class="o">+=</span> <span class="s1">&#39;.csv&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">eye_events</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">new_correction_file_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                
            <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer_start</span><span class="p">)</span>
            <span class="n">today</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;Saved,Date &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot; Trial Name&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trial_name</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot; File Path &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_correction_file_name</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot; Duration &quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
                <span class="o">+</span> <span class="s2">&quot;,&quot;</span>
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
                <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="c1">#self.save_metadata_file(new_correction_file_name)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span> <span class="s2">&quot;Corrections Saved to&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">new_correction_file_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Save Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No Corrections Made&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.save_aoi_csv">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.save_aoi_csv">[docs]</a>
    <span class="k">def</span> <span class="nf">save_aoi_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">default_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_AOI.csv&#39;</span>
        <span class="n">new_aoi_file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Save AOI&quot;</span><span class="p">,</span> <span class="n">default_file_name</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">new_aoi_file_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="s1">&#39;.csv&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_aoi_file_name</span><span class="p">:</span>
            <span class="n">new_aoi_file_name</span> <span class="o">+=</span> <span class="s1">&#39;.csv&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">aoi</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">new_aoi_file_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status_text</span> <span class="o">=</span> <span class="s2">&quot;AOI Saved to&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">new_aoi_file_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">statusBar</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">status_text</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Save Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No AOI Found&quot;</span><span class="p">)</span></div>


    
<div class="viewcode-block" id="Fix8.save_image">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.save_image">[docs]</a>
    <span class="k">def</span> <span class="nf">save_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># save image with png, jpg, or jpeg, default to png </span>
        <span class="c1"># dpi is set to 300 for high quality</span>
        <span class="n">qfd</span> <span class="o">=</span> <span class="n">QFileDialog</span><span class="p">()</span>
        <span class="n">default_file_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trial_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_FIX8.png&#39;</span>
        <span class="n">new_image_file_name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">qfd</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="p">,</span> <span class="s2">&quot;Save Image&quot;</span><span class="p">,</span> <span class="n">default_file_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_image_file_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_error_message</span><span class="p">(</span><span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="s2">&quot;No file selected&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;.png&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_image_file_name</span> 
            <span class="ow">and</span> <span class="s1">&#39;.jpg&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_image_file_name</span> 
            <span class="ow">and</span> <span class="s1">&#39;.jpeg&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_image_file_name</span>
            <span class="ow">and</span> <span class="s1">&#39;.svg&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_image_file_name</span>
            <span class="p">):</span>
            <span class="n">new_image_file_name</span> <span class="o">+=</span> <span class="s1">&#39;.png&#39;</span>

        <span class="c1"># if name includes svg, save as svg</span>
        <span class="k">if</span> <span class="s1">&#39;.svg&#39;</span> <span class="ow">in</span> <span class="n">new_image_file_name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">new_image_file_name</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">new_image_file_name</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.progress_bar_updated">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.progress_bar_updated">[docs]</a>
    <span class="k">def</span> <span class="nf">progress_bar_updated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># update the current suggested correction to the last fixation of the list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># update current suggestion to the progress bar</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">label_progress</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixations</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">progress_bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">draw</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">background</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_canvas</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">(</span><span class="n">all_fixations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.aoi_height_changed">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.aoi_height_changed">[docs]</a>
    <span class="k">def</span> <span class="nf">aoi_height_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aoi_height</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_aoi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">()</span></div>

        
<div class="viewcode-block" id="Fix8.aoi_width_changed">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.aoi_width_changed">[docs]</a>
    <span class="k">def</span> <span class="nf">aoi_width_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aoi_width</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_aoi</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">()</span></div>


<div class="viewcode-block" id="Fix8.select_fixation_color">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.select_fixation_color">[docs]</a>
    <span class="k">def</span> <span class="nf">select_fixation_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">QColorDialog</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="n">QColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixation_color</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">color</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixation_color</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixation_color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">(</span><span class="n">all_fixations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.select_current_fixation_color">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.select_current_fixation_color">[docs]</a>
    <span class="k">def</span> <span class="nf">select_current_fixation_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">QColorDialog</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="n">QColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_fixation_color</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">color</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation_color</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation_color</span> <span class="o">=</span> <span class="s2">&quot;magenta&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">(</span><span class="n">all_fixations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.select_suggested_fixation_color">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.select_suggested_fixation_color">[docs]</a>
    <span class="k">def</span> <span class="nf">select_suggested_fixation_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">QColorDialog</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="n">QColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">suggested_fixation_color</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">color</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">suggested_fixation_color</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">suggested_fixation_color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">(</span><span class="n">all_fixations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.select_remaining_fixation_color">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.select_remaining_fixation_color">[docs]</a>
    <span class="k">def</span> <span class="nf">select_remaining_fixation_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">QColorDialog</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="n">QColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remaining_fixation_color</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">color</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remaining_fixation_color</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remaining_fixation_color</span> <span class="o">=</span> <span class="s2">&quot;grey&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">(</span><span class="n">all_fixations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.select_saccade_color">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.select_saccade_color">[docs]</a>
    <span class="k">def</span> <span class="nf">select_saccade_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">QColorDialog</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="n">QColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saccade_color</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">color</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saccade_color</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saccade_color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">(</span><span class="n">all_fixations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.select_aoi_color">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.select_aoi_color">[docs]</a>
    <span class="k">def</span> <span class="nf">select_aoi_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">QColorDialog</span><span class="o">.</span><span class="n">getColor</span><span class="p">(</span><span class="n">initial</span><span class="o">=</span><span class="n">QColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aoi_color</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">color</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aoi_color</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aoi_color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">(</span><span class="n">all_fixations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.colorblind_assist">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.colorblind_assist">[docs]</a>
    <span class="k">def</span> <span class="nf">colorblind_assist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">colorblind_assist_status</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixation_color</span> <span class="o">=</span> <span class="s2">&quot;#00ff00&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_fixation_color</span> <span class="o">=</span> <span class="s2">&quot;#ff00ff&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saccade_color</span> <span class="o">=</span> <span class="s2">&quot;#0000ff&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aoi_color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorblind_assist_status</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">(</span><span class="n">all_fixations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fixation_color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saccade_color</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aoi_color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colorblind_assist_status</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">(</span><span class="n">all_fixations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.saccade_opacity_changed">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.saccade_opacity_changed">[docs]</a>
    <span class="k">def</span> <span class="nf">saccade_opacity_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saccade_opacity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">(</span><span class="n">all_fixations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="Fix8.saccade_width_changed">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.saccade_width_changed">[docs]</a>
    <span class="k">def</span> <span class="nf">saccade_width_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saccade_line_size</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_canvas</span><span class="p">()</span></div>


<div class="viewcode-block" id="Fix8.fixation_opacity_changed">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.fixation_opacity_changed">[docs]</a>
    <span class="k">def</span> <span class="nf">fixation_opacity_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixation_opacity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quick_draw_canvas</span><span class="p">(</span><span class="n">all_fixations</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="Fix8.fixation_size_changed">
<a class="viewcode-back" href="../source/fix8.html#fix8.Fix8.fixation_size_changed">[docs]</a>
    <span class="k">def</span> <span class="nf">fixation_size_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixation_size</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="mi">6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_canvas</span><span class="p">()</span></div>
</div>

    
<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../source/fix8.html#fix8.main">[docs]</a>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">ctypes</span>
        <span class="n">myappid</span> <span class="o">=</span> <span class="s1">&#39;ThisCanBeAnything&#39;</span> <span class="c1"># arbitrary string</span>

        <span class="c1"># This helps Windows manage and group windows of this application together</span>
        <span class="c1"># And helps us maintain the taskbar icon</span>
        <span class="n">ctypes</span><span class="o">.</span><span class="n">windll</span><span class="o">.</span><span class="n">shell32</span><span class="o">.</span><span class="n">SetCurrentProcessExplicitAppUserModelID</span><span class="p">(</span><span class="n">myappid</span><span class="p">)</span>

    <span class="n">window</span> <span class="o">=</span> <span class="n">Fix8</span><span class="p">()</span>
    <span class="n">window</span><span class="o">.</span><span class="n">fix8</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">fix8</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Naser Al Madi, Brett Torra, Agnes Li, Najam Tariq, Ricky Peng.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>